pipeline {
agent any
tools {
  maven 'm1'
}
 stages {
  stage('clone') {
    steps {
   checkout scmGit(branches: [[name: '*/master']], extensions: [], userRemoteConfigs: [[credentialsId: 'ssh key', url: 'https://github.com/Nagaveni-29/Amazon-1.git']])
    }
  }

  stage('build') {
    steps {
        sh 'mvn clean install' 
    }
  }

  stage('test') {
    steps {
      sh 'mvn test'
    }

    post {
      always {
        archiveArtifacts artifacts: 'Amazon-Core/target/**.jar', followSymlinks: false
        junit 'Amazon-Core/target/surefire-reports/*.*xml'
      }
    }
  }
 stage('run') {
    steps {
    sh 'cp Amazon-Web/target/*.war /opt/aptomcat/webapps/'
    sh '/opt/aptomcat/bin/startup.sh'
        
    }
  }

}
 }
